!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("http"),require("express"),require("cors"),require("smarkt"),require("yaml"),require("json5"),require("fs"),require("path"),require("front-matter"),require("pluralize"),require("jsonata"),require("node-fetch")):"function"==typeof define&&define.amd?define(["http","express","cors","smarkt","yaml","json5","fs","path","front-matter","pluralize","jsonata","node-fetch"],t):(e=e||self).stancy=t(e.http,e.express,e.cors,e.smarkt,e.YAML,e.JSON5,e.fs,e.path,e.frontmatter,e.pluralize,e.jsonata,e.nodeFetch)}(this,(function(e,t,r,n,s,o,i,c,u,a,l,p){"use strict";function f(e){if(e.match(/\.([0-9a-z]+)(?:[?#]|$)/i))return e.match(/\.([0-9a-z]+)(?:[?#]|$)/i)[1]}function d(e,t){return function(e,t){if(!process.browser&&"json"===f(t)){let r=i.readFileSync(c.join(e,t),"utf8");return JSON.parse(r)}}(e,t)||function(e,t){if(!process.browser&&"md"===f(t)){var r=i.readFileSync(c.join(e,t),"utf8");const{attributes:n,body:s}=u(r);return{...n,content:s}}}(e,t)||function(e,t){if(!process.browser&&"txt"===f(t)){return n.parse(i.readFileSync(c.join(e,t),"utf8"))}}(e,t)||function(e,t){if(!process.browser&&("yml"===f(t)||"yaml"===f(t))){return s.parse(i.readFileSync(c.join(e,t),"utf8"))}}(e,t)||function(e,t){if(!process.browser&&"json5"===f(t)){let r=i.readFileSync(c.join(e,t),"utf8");return o.parse(r)}}(e,t)}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l,p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p;const y={is:{file:function(e){return!!/\..+$/.test(e)&&e.split(".")[0]},folder:function(e){return!/\..+$/.test(e)&&e},singular:function(e){return a.isSingular(e)},plural:function(e){return a.isPlural(e)},index:function(e){return/^index..+$/.test(e)},collection:function(e,t){let r=!1;return y.is.folder(t)&&(r=!0),r},item:function(e,t){let r=!1;return(y.is.file(t)||y.has.index(e,t))&&(r=!0),r},hidden:function(e){return/^_/.test(e)}},has:{index:function(e,t){let r=!1;return y.is.folder(t)&&i.readdirSync(c.join(e+t)).map(e=>{y.is.index(e)&&(r=!0)}),r},children:function(e,t){let r=!1;return y.is.folder(t)&&i.readdirSync(c.join(e+t)).map(()=>{r=!0}),r}}};function h(e){let t=e;return i.readdirSync(e).map((r,n)=>function e(t,r,n,s,o){if(y.is.hidden(r))return;let u={_index:n,_name:r.split(".")[0]},a=r.split(".")[0];"home"===r&&(a="");let l=t.replace(o.replace(c.sep,""),"");if(u.url=c.join(l+a),u._source=c.join(t+a),y.is.singular(r),y.is.folder(r)&&y.has.index(t,r),y.is.item(t,r)&&(u._collection=s,u._type=s||r.split(".")[0]),y.is.folder(r)){let n=c.join(t+r+"/"),s=r;i.readdirSync(n).map((t,r)=>{e(n,t,r,s,o)})}if(y.is.file(r)&&Object.assign(u,d(t,r)),y.is.folder(r)&&!y.is.item(t,r)){let e="";i.readdirSync(t).map(r=>{/index..+$/.test(r)&&(e=d(t,r))}),Object.assign(u,e)}if(y.is.folder(r)){let n=c.join(t+r+"/"),s=r;u[s]=[],i.readdirSync(c.join(t+r)).map((t,r)=>{y.is.index(t)||u[s].push(e(n,t,r,s,o))})}return u}(e,r,n,null,t))}async function j(e,{resource1:t,resource2:r,query:n}){var s,o=l(`**[_type="${t}"]`);if(t&&!r){if(n){let e=[];for(let[t,r]of Object.entries(n)){let n=`[${t}=${r}]`;e.push(n)}o=l(`**[_type="${t}"]${e.toString()}`)}return o.evaluate(e)}if(t&&r){if(n){let e=[];for(let[t,r]of Object.entries(n)){let n=`[${t}=${r}]`;e.push(n)}o=l(`**[_type="${t}"][_name="${r}"]${e.toString()}`)}return o.evaluate(e)}if((!t||!r)&&n){if(s=n,0===Object.keys(s).length&&s.constructor===Object)return e;let t=[];for(let[e,r]of Object.entries(n)){let n=`[${e}=${r}]`;t.push(n)}return(o=l("**"+t.toString())).evaluate(e)}}class m{constructor(e,t,r){r&&(this._source=r),this._options={production:e},t&&Object.assign(this._options,{preview:t})}_process(e,t){return e=JSON.parse(e),t.preprocess?("content"===t.preprocess[0]&&(Array.isArray(e)?e.map(e=>{e.content&&(e.content=t.preprocess[1](e.content))}):e.content&&(e.content=t.preprocess[1](e.content))),"item"===t.preprocess[0]&&(Array.isArray(e)?e.map(e=>t.preprocess[1](e)):e=t.preprocess[1](e)),"collection"===t.preprocess[0]&&Array.isArray(e)&&(e=t.preprocess[1](e)),e):e}get(e){var t=this._options;return(process.browser?window.fetch:p)(`${"development"===process.env.NODE_ENV&&t.preview&&"undefined"!==this._source&&!process.browser?t.preview:t.production}${e}`).then(e=>e.text()).then(e=>{try{return this._process(e,t)}catch(t){return e}})}preprocess(e,t){Object.assign(this._options,{preprocess:[e,t]})}}return function(n){return new class{constructor(e){"undefined"!==e&&(this._source=e)}server(n,s){if(!this._source)return console.log("[Stancy] No source provided");n=n||4e3,s=s||"/",this._local=`http://localhost:${n}${s}`;var o,i=this._source;function c(){e.createServer(function(e){var n=t();return o=h(i),n.use(r({origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,optionsSuccessStatus:204})),n.set("json spaces",4),n.get(e,(e,t)=>{j(o,{resource1:null,resource2:null,query:e.query}).then(r=>{r?t.json(r):t.send("[Stancy] No value that matches query \n "+e.url)})}),n.get(e+":resource1",(e,t)=>{j(o,{resource1:e.params.resource1,resource2:null,query:e.query}).then(r=>{r?t.json(r):t.send("[Stancy] No value that matches query \n "+e.url)})}),n.get(e+":resource1/:resource2",(e,t)=>{j(o,{resource1:e.params.resource1,resource2:e.params.resource2,query:e.query}).then(r=>{r?t.json(r):t.send("[Stancy] No value that matches query \n "+e.url)})}),n}(s)).listen(n,()=>{console.log(`[Stancy] Content server available at http://localhost:${n}${s}`)})}c()}client(e){return this._local||process.browser||this.server(),new m(e,this._local,this._source)}database(){return h(this._source)}}(n)}}));
